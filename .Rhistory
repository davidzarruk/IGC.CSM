kappa1=kappa1,
xi1=xi1,
sigma0=sigma0,
F=F);
zeta = 0.0001
# Solve model
results_m_bl  = solveModel1_Eff(N=N,
S=S,
L_bar=L_bar,
H_bar=H_bar,
H_bar_rest=H_bar_rest,
tau=tau,
A=inversion_m_bl$A,
u_eq=inversion_m_bl$u,
B=inversion_m_bl$B,
w_eq=inversion_m_bl$w,
lambda_i=lambda_i,
lambda_is_i=lambda_is_i,
zeta=zeta,
tol=tol,
maxiter=maxiter,
endo_Lr=endo_Lr,
alpha1=alpha1,
beta0=beta0,
theta1=theta1,
eta1=eta1,
kappa1=kappa1,
xi1=xi1,
sigma0=sigma0,
F=F);
inversion_m_bl  = inversionModel_Eff(N=875,
S=3,
L_bar=1,
H_bar=read.csv("data/H_bar.csv"),
H_bar_rest=18,
tau=read.csv("data/tau.csv"),
lambda_i=read.csv("data/lambda_i.csv"),
lambda_is_i=read.csv("data/lambda_is_i.csv"),
L_j_data=read.csv("data/L_j_data.csv"),
zeta=0.1,
z_init=0.0001,
tol=10^-6,
maxiter=10,
alpha1=0.7,
beta0=0.7,
theta1=7,
eta1=1.5,
kappa1=2,
sigma0=6,
xi1=1.8,
nu_init=0.005,
F=1);
# Solve model
results_m_bl  = solveModel1_Eff(N=875,
S=3,
L_bar=1,
H_bar=read.csv("data/H_bar.csv"),
H_bar_rest=18,
tau=read.csv("data/tau.csv"),
A=inversion_m_bl$A,
u_eq=inversion_m_bl$u,
B=inversion_m_bl$B,
w_eq=inversion_m_bl$w,
lambda_i=read.csv("data/lambda_i.csv"),
lambda_is_i=read.csv("data/lambda_is_i.csv"),
zeta=0.0001,
tol=1e-10,
maxiter=10,
endo_Lr=1,
alpha1=0.7,
beta0=0.7,
delta0=0.65,
theta1=7,
eta1=1.5,
kappa1=2,
xi1=1.8,
sigma0=6,
F=1);
results_m_bl  = solveModel1_Eff(N=875,
S=3,
L_bar=1,
H_bar=read.csv("data/H_bar.csv"),
H_bar_rest=18,
tau=read.csv("data/tau.csv"),
A=inversion_m_bl$A,
u_eq=inversion_m_bl$u,
B=inversion_m_bl$B,
w_eq=inversion_m_bl$w,
lambda_i=read.csv("data/lambda_i.csv"),
lambda_is_i=read.csv("data/lambda_is_i.csv"),
zeta=0.0001,
tol=1e-10,
maxiter=10,
endo_Lr=1,
alpha1=0.7,
beta0=0.7,
theta1=7,
eta1=1.5,
kappa1=2,
xi1=1.8,
sigma0=6,
F=1);
df_res = df %>% filter(risk <= 21, risk_2 <= 9, impatience >= 0, impatience_2 >= 2, ACQUISITION_SCORE > 2)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df = read.csv('data_encuesta_plus.csv')
ggplot(data=df %>% filter(HIT == 0)) +
geom_smooth(aes(y=IMPAGADOR, x=impatience), span=1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+ (%)") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
mean(df %>% filter(HIT == 1, impatience > 14) %>% .$PLUS_PV2)
mean(df %>% filter(HIT == 1, impatience <= 14) %>% .$PLUS_PV2)
mod=lm(data=df %>% filter(HIT == 0),
as.formula(paste("PLUS_PV2 ~ impatience + BC_SCORE + risk + USER_AGE + impatience_2 + risk_2")))
summary(mod)
ggplot(data=df %>% filter(HIT == 1, TENURE_CHURN_SEGMENT == 'LTLR')) +
geom_smooth(aes(y=IMPAGADOR, x=risk), span=0.1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+ (%)") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE > 650, TENURE_CHURN_SEGMENT == 'LTLR')) +
geom_smooth(aes(y=IMPAGADOR, x=risk), span=0.1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+ (%)") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(TYPE_USER == 'POTENTIAL_HQ_RET', TENURE_CHURN_SEGMENT == 'LTLR')) +
geom_smooth(aes(y=IMPAGADOR, x=risk), span=0.1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+ (%)") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(HIT == 1)) +
geom_smooth(aes(y=IMPAGADOR, x=risk), span=1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+ (%)") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
impagadores = df %>% filter(HIT == 1, risk >= 29) %>% summarise(sum(IMPAGADOR))
pagadores = df %>% filter(HIT == 1, risk >= 29) %>% summarise(sum(IMPAGADOR==0))
log(impagadores/pagadores)
mean(df %>% filter(TENURE_CHURN_SEGMENT == 'LTLR', risk < 18, risk_2 < 8) %>% .$IMPAGADOR)
mean(df %>% filter(HIT == 1, risk < 18, risk_2 < 8) %>% .$IMPAGADOR)
mean(df %>% filter(risk < 17, risk_2 < 7) %>% .$IMPAGADOR, na.rm = TRUE)
mean(df %>% filter(HIT == 1, TENURE_CHURN_SEGMENT == 'LTLR', risk < 18) %>% .$IMPAGADOR)
mean(df %>% filter(HIT == 1, TENURE_CHURN_SEGMENT == 'LTLR', risk > 25) %>% .$IMPAGADOR)
hist(df %>% filter(HIT == 1, TENURE_CHURN_SEGMENT == 'LTLR', risk < 18) %>% .$risk_2)
hist(df %>% filter(HIT == 1, TENURE_CHURN_SEGMENT == 'LTLR', risk > 25) %>% .$risk_2)
minimo = 10
for(i in seq(1, 33, length.out = 17)){
for(j in seq(1, 11, length.out = 6)){
print(paste(i, j))
for(k in seq(32, 0, length.out = 17)){
for(l in seq(10, 0, length.out = 6)){
df_reducido = df %>% filter(risk <= i, risk_2 <= j, impatience >= k, impatience_2 >= l)
if(dim(df_reducido)[1] > 300){
m=mean(df_reducido$IMPAGADOR, na.rm = TRUE)
if(m < 0.005){
minimo = m
print(paste("Minimo=", minimo, ", valores=(", i, j, k, l, "), tamaño=", dim(df_reducido)[1]))
}
}
}
}
}
}
df_res = df %>% filter(risk <= 21, risk_2 <= 7, impatience >= 2, impatience_2 >= 0)
mean(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter(risk <= 19, risk_2 <= 7, impatience >= 2, impatience_2 >= 0)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
minimo = 10
for(i in seq(1, 33, length.out = 17)){
for(j in seq(1, 11, length.out = 6)){
print(paste(i, j))
for(k in seq(0, 32, length.out = 17)){
for(l in seq(0, 10, length.out = 6)){
df_reducido = df %>% filter(risk <= i, risk_2 <= j, impatience >= k, impatience_2 >= l, HIT == 1)
if(dim(df_reducido)[1] > 200){
m=mean(df_reducido$IMPAGADOR, na.rm = TRUE)
if(m < 0.004){
minimo = m
print(paste("Minimo=", minimo, ", valores=(", i, j, k, l, "), tamaño=", dim(df_reducido)[1]))
}
}
}
}
}
}
df_res = df %>% filter(risk < 25, risk_2 < 7, impatience > 2, impatience_2 > 0, HIT == 1)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
minimo = 10
for(i in seq(1, 33, length.out = 17)){
for(j in seq(1, 11, length.out = 6)){
print(paste(i, j))
for(k in seq(0, 32, length.out = 17)){
for(l in seq(0, 10, length.out = 6)){
df_reducido = df %>% filter(risk <= i, risk_2 <= j, impatience >= k, impatience_2 >= l, TENURE_CHURN_SEGMENT == 'LTLR')
if(dim(df_reducido)[1] > 200){
m=mean(df_reducido$IMPAGADOR, na.rm = TRUE)
if(m < 0.004){
minimo = m
print(paste("Minimo=", minimo, ", valores=(", i, j, k, l, "), tamaño=", dim(df_reducido)[1]))
}
}
}
}
}
}
df_res = df %>% filter(risk <= 15, risk_2 <= 7, impatience >= 0, impatience_2 >= 2, TENURE_CHURN_SEGMENT == 'LTLR')
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
minimo = 10
for(i in seq(1, 33, length.out = 17)){
for(j in seq(1, 11, length.out = 6)){
print(paste(i, j))
for(k in seq(0, 32, length.out = 17)){
for(l in seq(0, 10, length.out = 6)){
df_reducido = df %>% filter(risk <= i, risk_2 <= j, impatience >= k, impatience_2 >= l, TENURE_CHURN_SEGMENT == 'LTOR')
if(dim(df_reducido)[1] > 200){
m=mean(df_reducido$IMPAGADOR, na.rm = TRUE)
if(m < 0.004){
minimo = m
print(paste("Minimo=", minimo, ", valores=(", i, j, k, l, "), tamaño=", dim(df_reducido)[1]))
}
}
}
}
}
}
df_res = df %>% filter(risk <= 33, risk_2 <= 9, impatience >= 2, impatience_2 >= 2, TENURE_CHURN_SEGMENT == 'LTOR')
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
minimo = 10
for(i in seq(1, 33, length.out = 17)){
for(j in seq(1, 11, length.out = 6)){
print(paste(i, j))
for(k in seq(32, 0, length.out = 17)){
for(l in seq(10, 0, length.out = 6)){
df_reducido = df %>% filter(risk <= i, risk_2 <= j, impatience >= k, impatience_2 >= l, ACQUISITION_SCORE > 3)
if(dim(df_reducido)[1] > 200){
m=mean(df_reducido$IMPAGADOR, na.rm = TRUE)
if(m <= 0.004){
minimo = m
print(paste("Minimo=", minimo, ", valores=(", i, j, k, l, "), tamaño=", dim(df_reducido)[1]))
}
}
}
}
}
}
df_res = df %>% filter(risk <= 21, risk_2 <= 9, impatience >= 0, impatience_2 >= 0, ACQUISITION_SCORE > 3)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
minimo = 10
for(i in seq(1, 33, length.out = 17)){
for(j in seq(1, 11, length.out = 6)){
print(paste(i, j))
for(k in seq(32, 0, length.out = 17)){
for(l in seq(10, 0, length.out = 6)){
df_reducido = df %>% filter(risk <= i, risk_2 <= j, impatience >= k, impatience_2 >= l, ACQUISITION_SCORE > 2)
if(dim(df_reducido)[1] > 200){
m=mean(df_reducido$IMPAGADOR, na.rm = TRUE)
if(m <= 0.004){
minimo = m
print(paste("Minimo=", minimo, ", valores=(", i, j, k, l, "), tamaño=", dim(df_reducido)[1]))
}
}
}
}
}
}
df_res = df %>% filter(risk <= 21, risk_2 <= 9, impatience >= 0, impatience_2 >= 2, ACQUISITION_SCORE > 2)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
library(dplyr)
rm(list = ls())
setwd('/home/david/Downloads/')
df_impago = read.csv('impagadores_sicosocial_v2.csv', stringsAsFactors = FALSE)
df_respuestas = read.csv('responses (10).csv', stringsAsFactors = FALSE)
df_impago$USER_ID = paste0('MX_', df_impago$USER_ID)
df = merge(x=df_respuestas, y=df_impago, by.x = 'userid', by.y='USER_ID', all.x = TRUE)
df$impatience = ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.2.150.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 1,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.2.150.pesos.en.un.año...Cuál.escogerías." == "2,150 pesos en un año", 2,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.2.060.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 3,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.2.060.pesos.en.un.año...Cuál.escogerías." == "2,060 pesos en un año", 4,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.970.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 5,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.970.pesos.en.un.año...Cuál.escogerías." == "1,970 pesos en un año", 6,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.890.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 7,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.890.pesos.en.un.año...Cuál.escogerías." == "1,890 pesos en un año", 8,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.810.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 9,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.810.pesos.en.un.año...Cuál.escogerías." == "1,810 pesos en un año", 10,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.730.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 11,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.730.pesos.en.un.año...Cuál.escogerías." == "1,730 pesos en un año", 12,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.650.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 13,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.650.pesos.en.un.año...Cuál.escogerías." == "1,650 pesos en un año", 14,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.580.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 15,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.580.pesos.en.un.año...Cuál.escogerías." == "1,580 pesos en un año", 16,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.500.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 17,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.500.pesos.en.un.año...Cuál.escogerías." == "1,500 pesos en un año", 18,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.430.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 19,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.430.pesos.en.un.año...Cuál.escogerías." == "1,430 pesos en un año", 20,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.360.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 21,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.360.pesos.en.un.año...Cuál.escogerías." == "1,360 pesos en un año", 22,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.290.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 23,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.290.pesos.en.un.año...Cuál.escogerías." == "1,290 pesos en un año", 24,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.220.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 25,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.220.pesos.en.un.año...Cuál.escogerías." == "1,220 pesos en un año", 26,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.160.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 27,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.160.pesos.en.un.año...Cuál.escogerías." == "1,160 pesos en un año", 28,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.090.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 29,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.090.pesos.en.un.año...Cuál.escogerías." == "1,090 pesos en un año", 30,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.030.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 31,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.030.pesos.en.un.año...Cuál.escogerías." == "1,030 pesos en un año", 32, NA))))))))))))))))))))))))))))))))
df$impatience_2 = df$X.Qué.tanto.estarías.dispuesto.a..a.renunciar.a.algo.que.te.beneficia.en.el.presente.por.recibir.más.de.eso.en.el.futuro.
df$risk_2 = df$X.En.general..qué.tanto.estás.dispuesto.a..a.tomar.riesgos.
df$risk = ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.3.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 32,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.3.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,100 pesos", 31,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.900.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 30,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.900.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "2,900 pesos", 29,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.700.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 28,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.700.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "2,700 pesos", 27,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.500.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 26,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.500.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "2,500 pesos", 25,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.300.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 24,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.300.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "2,300 pesos", 23,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 22,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "2,100 pesos", 21,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.900.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 20,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.900.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "1,900 pesos", 19,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.700.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 18,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.700.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "1,700 pesos", 17,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.500.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 16,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.500.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "1,500 pesos", 15,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.300.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 14,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.300.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "1,300 pesos", 13,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 12,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "1,100 pesos", 11,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.900.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 10,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.900.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "900 pesos", 9,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.700.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 8,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.700.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "700 pesos", 7,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.500.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 6,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.500.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "500 pesos", 5,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.300.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 4,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.300.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "300 pesos", 3,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 2,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "100 pesos", 1, NA))))))))))))))))))))))))))))))))
controles = c("CCSCORE_1", "CCSCORE_2", "CCSCORE_3", "CCSCORE_4", "CCSCORE_5", "TOP_PETS", "TOP_GMV",
"GMV_PTILE_95", "GMV_PTILE_90_95", "GMV_PTILE_80_90", "GMV_PTILE_70_80", "GMV_PTILE_50_70",
"LIQUOR_TOP_95", "LIQUOR_TOP_90", "LIQUOR_TOP_80", "LIQUOR_TOP_70", "ALTA_COCINA_ORDERS",
"REST_PTILE", "TOP_LIQUORS", "TOP_TRAVEL", "HAS_RISK_COMPENSATION", "MICROZONE_0_20",
"MICROZONE_90_100", "MICROZONE_80_90", "MICROZONE_50_80", "MICROZONE_20_40", "AVG_ORDERS", 'BC_SCORE')
df %>% select(IMPAGADOR, SAL_CRED_AUTORIZADO)
df$CC_SCORE = ifelse(df$CCSCORE_5 == 1, 5,
ifelse(df$CCSCORE_4 == 1, 4,
ifelse(df$CCSCORE_3 == 1, 3,
ifelse(df$CCSCORE_2 == 1, 2,
ifelse(df$CCSCORE_1 == 1, 1, 0)))))
regress = function(df, variable){
df_red = df %>% filter(get(variable) <= quantile(df[[variable]], probs = 0.99, na.rm=TRUE))
df_red = df_red %>% mutate(impatience_sq = impatience*impatience,
impatience_2_sq = impatience_2*impatience_2,
risk_sq = risk*risk,
risk_2_sq = risk_2*risk_2)
mod=lm(data=df_red, as.formula(paste(variable, " ~ impatience + impatience_sq + impatience_2 + impatience_2_sq + risk + risk_sq + risk_2 + risk_2_sq +", paste(controles, collapse='+'))))
summary(mod)
}
variable = 'IMPAGADOR'
df_red = df %>% filter(get(variable) <= quantile(df[[variable]], probs = 0.99, na.rm=TRUE))
df_red = df_red %>% mutate(impatience_sq = impatience*impatience,
impatience_2_sq = impatience_2*impatience_2,
risk_sq = risk*risk,
risk_2_sq = risk_2*risk_2)
mod=lm(data=df_red %>% filter(TENURE_CHURN_SEGMENT == 'LTLR'),
as.formula(paste(variable, " ~ risk + risk_sq + BC_SCORE")))
summary(mod)
ggplot(data=df) +
geom_smooth(aes(x=risk, y=IMPAGADOR), span=1, method = 'loess')
ggplot(data=df) +
geom_smooth(aes(x=impatience, y=MONTO), span=1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk), span=1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=impatience_2), span=1, method = 'loess')
regress(df, 'BC_SCORE')
regress(df, 'INGRESO')
regress(df, 'MONTO')
regress(df, 'IMPAGADOR')
df = read.csv('data_encuesta_plus.csv')
ggplot(data=df %>% filter(HIT == 0)) +
geom_smooth(aes(y=IMPAGADOR, x=impatience), span=1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+ (%)") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
mean(df %>% filter(HIT == 1, impatience > 14) %>% .$PLUS_PV2)
mean(df %>% filter(HIT == 1, impatience <= 14) %>% .$PLUS_PV2)
mod=lm(data=df %>% filter(HIT == 0),
as.formula(paste("PLUS_PV2 ~ impatience + BC_SCORE + risk + USER_AGE + impatience_2 + risk_2")))
summary(mod)
ggplot(data=df %>% filter(HIT == 1, TENURE_CHURN_SEGMENT == 'LTLR')) +
geom_smooth(aes(y=IMPAGADOR, x=risk), span=0.1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+ (%)") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE > 650, TENURE_CHURN_SEGMENT == 'LTLR')) +
geom_smooth(aes(y=IMPAGADOR, x=risk), span=0.1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+ (%)") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(TYPE_USER == 'POTENTIAL_HQ_RET', TENURE_CHURN_SEGMENT == 'LTLR')) +
geom_smooth(aes(y=IMPAGADOR, x=risk), span=0.1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+ (%)") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(HIT == 1)) +
geom_smooth(aes(y=IMPAGADOR, x=risk), span=1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+ (%)") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
impagadores = df %>% filter(HIT == 1, risk >= 29) %>% summarise(sum(IMPAGADOR))
pagadores = df %>% filter(HIT == 1, risk >= 29) %>% summarise(sum(IMPAGADOR==0))
log(impagadores/pagadores)
mean(df %>% filter(TENURE_CHURN_SEGMENT == 'LTLR', risk < 18, risk_2 < 8) %>% .$IMPAGADOR)
mean(df %>% filter(HIT == 1, risk < 18, risk_2 < 8) %>% .$IMPAGADOR)
mean(df %>% filter(risk < 17, risk_2 < 7) %>% .$IMPAGADOR, na.rm = TRUE)
mean(df %>% filter(HIT == 1, TENURE_CHURN_SEGMENT == 'LTLR', risk < 18) %>% .$IMPAGADOR)
mean(df %>% filter(HIT == 1, TENURE_CHURN_SEGMENT == 'LTLR', risk > 25) %>% .$IMPAGADOR)
hist(df %>% filter(HIT == 1, TENURE_CHURN_SEGMENT == 'LTLR', risk < 18) %>% .$risk_2)
hist(df %>% filter(HIT == 1, TENURE_CHURN_SEGMENT == 'LTLR', risk > 25) %>% .$risk_2)
df_res = df %>% filter(risk <= 21, risk_2 <= 9, impatience >= 0, impatience_2 >= 2, ACQUISITION_SCORE > 2)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter((risk > 21 | risk_2 > 9 | impatience < 0 | impatience_2 < 2), ACQUISITION_SCORE > 2)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df %>% filter(ACQUISITION_SCORE > 2)
df %>% filter((risk > 21 | risk_2 > 9 | impatience < 0 | impatience_2 < 2), ACQUISITION_SCORE > 2)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter(risk <= 21, risk_2 <= 9, impatience >= 2, impatience_2 >= 0, ACQUISITION_SCORE > 2)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter((risk > 21 | risk_2 > 9 | impatience < 2 | impatience_2 < 0), ACQUISITION_SCORE > 2)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter(risk <= 21, risk_2 <= 7, impatience >= 2, impatience_2 >= 0)
mean(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter(risk > 21 | risk_2 > 7 | impatience < 2 | impatience_2 < 0)
mean(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter((risk >= 25 | risk_2 >= 7 | impatience <= 2 | impatience_2 <= 0), HIT == 1)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter((risk >= 25 | risk_2 >= 7 | impatience <= 2 | impatience_2 <= 0), HIT == 1)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter(risk > 21 | risk_2 > 7 | impatience < 2 | impatience_2 < 0)
mean(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter(risk <= 21, risk_2 <= 7, impatience >= 2, impatience_2 >= 0)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter(risk > 21 | risk_2 > 7 | impatience < 2 | impatience_2 < 0)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter((risk > 15 | risk_2 > 7 | impatience < 0 | impatience_2 < 2), TENURE_CHURN_SEGMENT == 'LTLR')
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter((risk > 33 | risk_2 > 9 | impatience < 2 | impatience_2 < 2), TENURE_CHURN_SEGMENT == 'LTOR')
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter((risk > 21 | risk_2 > 9 | impatience < 0 | impatience_2 < 0), ACQUISITION_SCORE > 3)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter((risk > 21 | risk_2 > 9 | impatience < 0 | impatience_2 < 2), ACQUISITION_SCORE > 2)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter((risk > 21 | risk_2 > 9 | impatience < 2 | impatience_2 < 0), ACQUISITION_SCORE > 2)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df_res = df %>% filter(risk > 19 | risk_2 > 7 | impatience < 2 | impatience_2 < 0)
mean(df_res$IMPAGADOR, na.rm=TRUE)
sum(df_res$IMPAGADOR, na.rm=TRUE)
dim(df_res)[1]
df %>% select(USER_ID, RPP_USER_ID, risk, risk_2, impatience, impatience_2)
write.csv(df %>% select(USER_ID, RPP_USER_ID, risk, risk_2, impatience, impatience_2),
'resultados_encuesta.csv')
write.csv(df %>% select(USER_ID, RPP_USER_ID, risk, risk_2, impatience, impatience_2, TENURE_CHURN_SEGMENT, HIT, ACQUISITION_SCORE),
'resultados_encuesta.csv')
