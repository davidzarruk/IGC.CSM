nobs(mod)
mod=lm(data=df, as.formula(paste("INGRESO ~ impatience + impatience_2 + risk + risk_2")))
summary(mod)
nobs(mod)
ggplot(data = df) +
geom_point(aes(x=risk, y=INGRESO))
ggplot(data = df) +
geom_point(aes(x=IMPATIENCE, y=INGRESO))
ggplot(data = df) +
geom_point(aes(x=impatience, y=INGRESO))
variable = INGRESO
variable = 'INGRESO'
df[[variable]]
quantile(df[[variable]], probs = 0.99)
quantile(df[[variable]], probs = 0.99, na.rm=TRUE)
quantile(df[[variable]], probs = 0.95, na.rm=TRUE)
df %>% filter(get(variable) < quantile(df[[variable]], probs = 0.99, na.rm=TRUE))
df %>% filter(get(variable) > quantile(df[[variable]], probs = 0.99, na.rm=TRUE))
df %>% filter(get(variable) < quantile(df[[variable]], probs = 0.99, na.rm=TRUE))
regress = function(df, variable){
df_red = df %>% filter(get(variable) <= quantile(df[[variable]], probs = 0.99, na.rm=TRUE))
mod=lm(data=df_red, as.formula(paste(variable, " ~ impatience + impatience_2 + risk + risk_2")))
summary(mod)
}
regress(df, 'BC_SCORE')
regress(df, 'INGRESO')
regress(df, 'MONTO')
regress(df, 'SAL_CRED_DISPUESTO')
regress(df, 'INGRESO')
regress(df, 'MONTO')
regress(df, 'BC_SCORE')
regress(df, 'MONTO_ADEUDADO')
regress(df, 'BC_SCORE')
mean(df[df$risk_2 > 5]$BC_SCORE)
mean(df[df$risk_2 > 5,]$BC_SCORE, na.rm = TRUE)
mean(df[df$risk_2 > 5,]$BC_SCORE, na.rm = TRUE)
mean(df[df$risk_2 < 5,]$BC_SCORE, na.rm = TRUE)
mean(df[df$risk_2 > 7,]$BC_SCORE, na.rm = TRUE)
mean(df[df$risk_2 < 5,]$BC_SCORE, na.rm = TRUE)
hist(df$risk_2)
mean(df[df$risk_2 > 8,]$BC_SCORE, na.rm = TRUE)
mean(df[df$risk_2 < 3,]$BC_SCORE, na.rm = TRUE)
hist(df$risk)
mean(df[df$risk > 15,]$BC_SCORE, na.rm = TRUE)
mean(df[df$risk < 15,]$BC_SCORE, na.rm = TRUE)
mean(df[df$risk > 20,]$BC_SCORE, na.rm = TRUE)
mean(df[df$risk < 10,]$BC_SCORE, na.rm = TRUE)
mean(df[df$risk > 25,]$BC_SCORE, na.rm = TRUE)
mean(df[df$risk < 5,]$BC_SCORE, na.rm = TRUE)
regress(df, 'BC_SCORE')
regress(df, 'INGRESO')
controles = c("CCSCORE_1", "CCSCORE_2", "CCSCORE_3", "CCSCORE_4", "CCSCORE_5", "TOP_PETS", "TOP_GMV",
"GMV_PTILE_95", "GMV_PTILE_90_95", "GMV_PTILE_80_90", "GMV_PTILE_70_80", "GMV_PTILE_50_70",
"LIQUOR_TOP_95", "LIQUOR_TOP_90", "LIQUOR_TOP_80", "LIQUOR_TOP_70", "ALTA_COCINA_ORDERS",
"REST_PTILE", "TOP_LIQUORS", "TOP_TRAVEL", "HAS_RISK_COMPENSATION", "MICROZONE_0_20",
"MICROZONE_90_100", "MICROZONE_80_90", "MICROZONE_50_80", "MICROZONE_20_40", "AVG_ORDERS", 'BC_SCORE')
regress = function(df, variable){
df_red = df %>% filter(get(variable) <= quantile(df[[variable]], probs = 0.99, na.rm=TRUE))
mod=lm(data=df_red, as.formula(paste(variable, " ~ impatience + impatience_2 + risk + risk_2 +", paste(controles, collapse='+'))))
summary(mod)
}
regress(df, 'BC_SCORE')
controles = c("CCSCORE_1", "CCSCORE_2", "CCSCORE_3", "CCSCORE_4", "CCSCORE_5", "TOP_PETS", "TOP_GMV",
"GMV_PTILE_95", "GMV_PTILE_90_95", "GMV_PTILE_80_90", "GMV_PTILE_70_80", "GMV_PTILE_50_70",
"LIQUOR_TOP_95", "LIQUOR_TOP_90", "LIQUOR_TOP_80", "LIQUOR_TOP_70", "ALTA_COCINA_ORDERS",
"REST_PTILE", "TOP_LIQUORS", "TOP_TRAVEL", "HAS_RISK_COMPENSATION", "MICROZONE_0_20",
"MICROZONE_90_100", "MICROZONE_80_90", "MICROZONE_50_80", "MICROZONE_20_40", "AVG_ORDERS", 'BC_SCORE')
regress = function(df, variable){
df_red = df %>% filter(get(variable) <= quantile(df[[variable]], probs = 0.99, na.rm=TRUE))
mod=lm(data=df_red, as.formula(paste(variable, " ~ impatience + impatience_2 + risk + risk_2 +", paste(controles, collapse='+'))))
summary(mod)
}
regress(df, 'BC_SCORE')
regress(df, 'INGRESO')
regress(df, 'IMPAGADOR')
regress(df, 'INGRESO')
hist(df$BC_SCORE)
df[df$BC_SCORE < 620,]$risk
regress(df, 'BC_SCORE')
mean(df[df$BC_SCORE < 620,]$risk_2)
mean(df[df$BC_SCORE < 620,]$risk_2, na.rm=TRUE)
mean(df[df$BC_SCORE > 680,]$risk_2, na.rm=TRUE)
mean(df[df$BC_SCORE < 620,]$risk, na.rm=TRUE)
mean(df[df$BC_SCORE > 680,]$risk, na.rm=TRUE)
ggplot() + geom_smooth(aes(x=BC_SCORE, y=risk_2), data=df)
ggplot() + geom_smooth(aes(x=BC_SCORE, y=risk_2), data=df, span=0.1)
ggplot() + geom_smooth(aes(x=BC_SCORE, y=risk_2), data=df, span=0.01)
ggplot() + geom_smooth(aes(x=BC_SCORE, y=risk_2), data=df, span=01)
ggplot() + geom_smooth(aes(x=BC_SCORE, y=risk_2), data=df, span=0.001)
ggplot() +
geom_point(aes(x=BC_SCORE, y=risk_2), data=df)
geom_smooth(aes(x=BC_SCORE, y=risk_2), data=df, span=0.001)
ggplot() +
geom_smooth(aes(x=BC_SCORE, y=risk_2), data=df, span=0.001)
ggplot() +
geom_smooth(aes(x=BC_SCORE, y=risk_2), data=df, span=0.00001)
ggplot() +
geom_smooth(aes(x=BC_SCORE, y=risk_2), data=df, span=100)
ggplot() +
geom_smooth(aes(x=BC_SCORE, y=risk_2), data=df, span=100, method = 'loess')
ggplot() +
geom_smooth(aes(x=BC_SCORE, y=risk_2), data=df, span=0.1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=0.1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=0.5, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk), span=1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=impatience), span=1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=impatience_2), span=1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk), span=1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_point(aes(x=BC_SCORE, y=risk_2)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_point(aes(x=BC_SCORE, y=risk_2)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=1, method = 'loess')
ggplot(data=df) +
geom_smooth(aes(x=risk_2, y=IMPAGADOR), span=1, method = 'loess')
ggplot(data=df) +
geom_smooth(aes(x=risk, y=IMPAGADOR), span=1, method = 'loess')
regress = function(df, variable){
df_red = df %>% filter(get(variable) <= quantile(df[[variable]], probs = 0.99, na.rm=TRUE))
mod=lm(data=df_red, as.formula(paste(variable, " ~ impatience + impatience*impatience + impatience_2 + risk + risk_2 +", paste(controles, collapse='+'))))
summary(mod)
}
regress(df, 'IMPAGADOR')
regress = function(df, variable){
df_red = df %>% filter(get(variable) <= quantile(df[[variable]], probs = 0.99, na.rm=TRUE))
df_red = df_red %>% mutate(impatience_sq = impatience*impatience,
impatience_2_sq = impatience_2*impatience_2,
risk_sq = risk*risk,
risk_2_sq = risk_2*risk_2)
mod=lm(data=df_red, as.formula(paste(variable, " ~ impatience + impatience_sq + impatience_2 + impatience_2_sq + risk + risk_sq + risk_2 + risk_2_sq +", paste(controles, collapse='+'))))
summary(mod)
}
regress(df, 'IMPAGADOR')
regress(df, 'BC_SCORE')
regress(df, 'INGRESO')
ggplot(data=df) +
geom_smooth(aes(x=risk, y=IMPAGADOR), span=1, method = 'loess')
regress(df, 'IMPAGADOR')
ggplot(data=df) +
geom_smooth(aes(x=risk, y=INGRESO), span=1, method = 'loess')
regress(df, 'INGRESO')
ggplot(data=df) +
geom_smooth(aes(x=impatience, y=INGRESO), span=1, method = 'loess')
regress(df, 'MONTO')
ggplot(data=df) +
geom_smooth(aes(x=impatience, y=MONTO), span=1, method = 'loess')
ggplot(data=df) +
geom_smooth(aes(x=risk, y=IMPAGADOR), span=1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=1, method = 'loess') +
xlab("BC Score") + ylab("Métrica #2 de riesgo")
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") + theme(plot.title = element_text(hjust=0.5)) +
theme_minimal()
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") + theme(plot.title = element_text(hjust=0.5)) +
theme_minimal() + ggtitle("Promedio de métrica de riesgo")
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") +
theme_minimal() + ggtitle("Promedio de métrica de riesgo") +theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") +
theme_minimal() + ggtitle("Promedio de métrica de riesgo vs BC Score") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=0.5, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") +
theme_minimal() + ggtitle("Promedio de métrica de riesgo vs BC Score") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") +
theme_minimal() + ggtitle("Promedio de métrica de riesgo vs BC Score") +
theme(plot.title = element_text(hjust=0.5))
regress(df, 'BC_SCORE')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") +
theme_minimal() + ggtitle("Promedio de métrica de riesgo vs BC Score") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") +
theme_minimal() + ggtitle("Promedio de métrica de riesgo #1 vs BC Score") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") +
theme_minimal() + ggtitle("Promedio de métrica de riesgo #2 vs BC Score") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=impatience), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") +
theme_minimal() + ggtitle("Promedio de métrica de riesgo #2 vs BC Score") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=impatience_2), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") +
theme_minimal() + ggtitle("Promedio de métrica de riesgo #2 vs BC Score") +
theme(plot.title = element_text(hjust=0.5))
regress(df, 'IMPAGADOR')
regress(df, 'IMPAGADOR')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=risk_2, y=BC_SCORE), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") +
theme_minimal() + ggtitle("Promedio de métrica de riesgo #2 vs BC Score") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(y=BC_SCORE, x=risk), span=1, method = 'loess') +
ylab("BC Score") + xlab("Riesgo") +
theme_minimal() + ggtitle("Promedio de BC Score vs métrica de riesgo #1") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk), span=1, method = 'loess') +
ylab("BC Score") + xlab("Riesgo") +
theme_minimal() + ggtitle("Promedio de BC Score vs métrica de riesgo #1") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(y=BC_SCORE, x=risk), span=1, method = 'loess') +
ylab("BC Score") + xlab("Riesgo") +
theme_minimal() + ggtitle("Promedio de BC Score vs métrica de riesgo #1") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(y=BC_SCORE, x=risk), span=0.5, method = 'loess') +
ylab("BC Score") + xlab("Riesgo") +
theme_minimal() + ggtitle("Promedio de BC Score vs métrica de riesgo #1") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk_2), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") +
theme_minimal() + ggtitle("Promedio de métrica de riesgo #2 vs BC Score") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") +
theme_minimal() + ggtitle("Promedio de métrica de riesgo #1 vs BC Score") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=IMPAGADOR, y=risk_2), span=1, method = 'loess') +
xlab("BC Score") + ylab("Riesgo") +
theme_minimal() + ggtitle("Promedio de métrica de riesgo #2 vs BC Score") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(y=IMPAGADOR, x=risk_2), span=1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(y=IMPAGADOR, x=risk), span=1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(y=IMPAGADOR, x=risk), span=1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+ (%)") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
regress(df, 'INGRESO')
ggplot(data=df) +
geom_smooth(aes(y=IMPAGADOR, x=risk), span=1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+ (%)") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df) +
geom_smooth(aes(y=INGRESO, x=impatience), span=1, method = 'loess') +
xlab("Riesgo") + ylab("PV2+ (%)") +
theme_minimal() + ggtitle("Promedio de PV2+ vs riesgo") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df) +
geom_smooth(aes(y=INGRESO, x=impatience), span=1, method = 'loess') +
xlab("Paciencia") + ylab("Ingreso") +
theme_minimal() + ggtitle("Promedio de ingreso vs paciencia") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df) +
geom_hist(aes(y=..density.., x=impatience))
ggplot(data=df) +
geom_histogram(aes(y=..density.., x=impatience))
ggplot(data=df) +
geom_histogram(aes(y=..density.., x=impatience), bins = 10)
ggplot(data=df) +
geom_histogram(aes(x=impatience), bins = 10) +
xlab("Paciencia") + ylab("Densidad")
ggplot(data=df) +
geom_histogram(aes(x=impatience), bins = 20) +
xlab("Paciencia") + ylab("Usuarios") +
theme_minimal() + ggtitle("Distribución de paciencia") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df) +
geom_histogram(aes(x=impatience_2), bins = 20) +
xlab("Paciencia") + ylab("Usuarios") +
theme_minimal() + ggtitle("Distribución de paciencia #2") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df) +
geom_histogram(aes(x=impatience_2), bins = 10) +
xlab("Paciencia") + ylab("Usuarios") +
theme_minimal() + ggtitle("Distribución de paciencia #2") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df) +
geom_histogram(aes(x=risk), bins = 20) +
xlab("Riesgo") + ylab("Usuarios") +
theme_minimal() + ggtitle("Distribución de riesgo #1") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df) +
geom_histogram(aes(x=risk_2), bins = 10) +
xlab("Riesgo") + ylab("Usuarios") +
theme_minimal() + ggtitle("Distribución de riesgo #2") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df) +
geom_histogram(aes(x=impatience), bins = 20) +
xlab("Paciencia") + ylab("Usuarios") +
theme_minimal() + ggtitle("Distribución de paciencia #1") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df) +
geom_histogram(aes(x=impatience_2), bins = 10) +
xlab("Paciencia") + ylab("Usuarios") +
theme_minimal() + ggtitle("Distribución de paciencia #2") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df) +
geom_histogram(aes(x=risk), bins = 20) +
xlab("Riesgo") + ylab("Usuarios") +
theme_minimal() + ggtitle("Distribución de riesgo #1") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df) +
geom_histogram(aes(x=risk_2), bins = 10) +
xlab("Riesgo") + ylab("Usuarios") +
theme_minimal() + ggtitle("Distribución de riesgo #2") +
theme(plot.title = element_text(hjust=0.5))
regress(df, 'MONTO')
ggplot(data=df) +
geom_smooth(aes(y=MONTO, x=impatience), span=1, method = 'loess') +
xlab("Paciencia") + ylab("Ingreso") +
theme_minimal() + ggtitle("Promedio de ingreso vs paciencia") +
theme(plot.title = element_text(hjust=0.5))
nobs(mod)
df %>% select(userid, BC_SCORE, impatience, impatience_2, risk, risk_2)
df %>% select(userid, BC_SCORE, INGRESO, impatience, impatience_2, risk, risk_2)
corr(df %>% select(impatience, impatience_2, risk, risk_2))
cor(df %>% select(impatience, impatience_2, risk, risk_2))
cor(df %>% select(impatience, impatience_2, risk, risk_2), na.rm=TRUE)
cor(df %>% select(impatience, impatience_2, risk, risk_2))
df
df %>% filter(is.na(impatience)==FALSE)
cor(df %>% filter(is.na(impatience)==FALSE) %>% select(impatience, impatience_2, risk, risk_2))
cor(df %>% filter(is.na(impatience)==FALSE, is.na(risk)==FALSE) %>% select(impatience, impatience_2, risk, risk_2))
cor(df %>% filter(is.na(impatience)==FALSE, is.na(risk)==FALSE, is.na(impatience_2)==FALSE, is.na(risk_2)==FALSE) %>% select(impatience, impatience_2, risk, risk_2))
cor(df %>% filter(is.na(impatience)==FALSE, is.na(risk)==FALSE, is.na(impatience_2)==FALSE, is.na(risk_2)==FALSE) %>% select(impatience, impatience_2, risk, risk_2, BC_SCORE))
cor(df %>% filter(is.na(impatience)==FALSE, is.na(risk)==FALSE, is.na(impatience_2)==FALSE, is.na(risk_2)==FALSE, is.na(BC_SCORE)==FALSE) %>% select(impatience, impatience_2, risk, risk_2, BC_SCORE))
df %>% filter(is.na(impatience)==FALSE, is.na(risk)==FALSE, is.na(impatience_2)==FALSE, is.na(risk_2)==FALSE, is.na(BC_SCORE)==FALSE)
lm(BC_SCORE ~ risk + risk_2, data=df %>% filter(is.na(impatience)==FALSE, is.na(risk)==FALSE, is.na(impatience_2)==FALSE, is.na(risk_2)==FALSE, is.na(BC_SCORE)==FALSE))
mod=lm(BC_SCORE ~ risk + risk_2, data=df %>% filter(is.na(impatience)==FALSE, is.na(risk)==FALSE, is.na(impatience_2)==FALSE, is.na(risk_2)==FALSE, is.na(BC_SCORE)==FALSE))
summary(mod)
cor(df %>% filter(is.na(impatience)==FALSE, is.na(risk)==FALSE, is.na(impatience_2)==FALSE, is.na(risk_2)==FALSE, is.na(BC_SCORE)==FALSE) %>% select(impatience, impatience_2, risk, risk_2, BC_SCORE))
library(dplyr)
rm(list = ls())
setwd('/home/david/Downloads/')
df_impago = read.csv('impagadores_sicosocial_v2.csv', stringsAsFactors = FALSE)
df_respuestas = read.csv('responses (10).csv', stringsAsFactors = FALSE)
df_impago$USER_ID = paste0('MX_', df_impago$USER_ID)
df = merge(x=df_respuestas, y=df_impago, by.x = 'userid', by.y='USER_ID', all.x = TRUE)
df$impatience = ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.2.150.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 1,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.2.150.pesos.en.un.año...Cuál.escogerías." == "2,150 pesos en un año", 2,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.2.060.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 3,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.2.060.pesos.en.un.año...Cuál.escogerías." == "2,060 pesos en un año", 4,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.970.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 5,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.970.pesos.en.un.año...Cuál.escogerías." == "1,970 pesos en un año", 6,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.890.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 7,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.890.pesos.en.un.año...Cuál.escogerías." == "1,890 pesos en un año", 8,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.810.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 9,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.810.pesos.en.un.año...Cuál.escogerías." == "1,810 pesos en un año", 10,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.730.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 11,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.730.pesos.en.un.año...Cuál.escogerías." == "1,730 pesos en un año", 12,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.650.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 13,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.650.pesos.en.un.año...Cuál.escogerías." == "1,650 pesos en un año", 14,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.580.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 15,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.580.pesos.en.un.año...Cuál.escogerías." == "1,580 pesos en un año", 16,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.500.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 17,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.500.pesos.en.un.año...Cuál.escogerías." == "1,500 pesos en un año", 18,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.430.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 19,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.430.pesos.en.un.año...Cuál.escogerías." == "1,430 pesos en un año", 20,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.360.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 21,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.360.pesos.en.un.año...Cuál.escogerías." == "1,360 pesos en un año", 22,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.290.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 23,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.290.pesos.en.un.año...Cuál.escogerías." == "1,290 pesos en un año", 24,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.220.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 25,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.220.pesos.en.un.año...Cuál.escogerías." == "1,220 pesos en un año", 26,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.160.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 27,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.160.pesos.en.un.año...Cuál.escogerías." == "1,160 pesos en un año", 28,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.090.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 29,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.090.pesos.en.un.año...Cuál.escogerías." == "1,090 pesos en un año", 30,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.030.pesos.en.un.año...Cuál.escogerías." == "1,000 pesos hoy", 31,
ifelse(df$"Imagina.que.puedes.elegir.entre.recibir.1.000.pesos.hoy.o.1.030.pesos.en.un.año...Cuál.escogerías." == "1,030 pesos en un año", 32, NA))))))))))))))))))))))))))))))))
df$impatience_2 = df$X.Qué.tanto.estarías.dispuesto.a..a.renunciar.a.algo.que.te.beneficia.en.el.presente.por.recibir.más.de.eso.en.el.futuro.
df$risk_2 = df$X.En.general..qué.tanto.estás.dispuesto.a..a.tomar.riesgos.
df$risk = ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.3.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 32,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.3.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,100 pesos", 31,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.900.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 30,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.900.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "2,900 pesos", 29,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.700.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 28,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.700.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "2,700 pesos", 27,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.500.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 26,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.500.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "2,500 pesos", 25,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.300.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 24,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.300.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "2,300 pesos", 23,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 22,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.2.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "2,100 pesos", 21,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.900.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 20,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.900.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "1,900 pesos", 19,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.700.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 18,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.700.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "1,700 pesos", 17,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.500.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 16,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.500.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "1,500 pesos", 15,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.300.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 14,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.300.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "1,300 pesos", 13,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 12,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.1.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "1,100 pesos", 11,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.900.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 10,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.900.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "900 pesos", 9,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.700.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 8,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.700.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "700 pesos", 7,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.500.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 6,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.500.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "500 pesos", 5,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.300.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 4,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.300.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "300 pesos", 3,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "3,000 pesos con 50% de probabilidad", 2,
ifelse(df$Imagina.que.puedes.elegir.entre.una.de.las.siguientes.dos.opciones...1..Recibir.100.pesos.2..Participar.en.una.rifa.por.3.000.pesos.con.50..de.probabilidad.de.ganar...Cuál.escogerías. == "100 pesos", 1, NA))))))))))))))))))))))))))))))))
controles = c("CCSCORE_1", "CCSCORE_2", "CCSCORE_3", "CCSCORE_4", "CCSCORE_5", "TOP_PETS", "TOP_GMV",
"GMV_PTILE_95", "GMV_PTILE_90_95", "GMV_PTILE_80_90", "GMV_PTILE_70_80", "GMV_PTILE_50_70",
"LIQUOR_TOP_95", "LIQUOR_TOP_90", "LIQUOR_TOP_80", "LIQUOR_TOP_70", "ALTA_COCINA_ORDERS",
"REST_PTILE", "TOP_LIQUORS", "TOP_TRAVEL", "HAS_RISK_COMPENSATION", "MICROZONE_0_20",
"MICROZONE_90_100", "MICROZONE_80_90", "MICROZONE_50_80", "MICROZONE_20_40", "AVG_ORDERS", 'BC_SCORE')
df %>% select(IMPAGADOR, SAL_CRED_AUTORIZADO)
df$CC_SCORE = ifelse(df$CCSCORE_5 == 1, 5,
ifelse(df$CCSCORE_4 == 1, 4,
ifelse(df$CCSCORE_3 == 1, 3,
ifelse(df$CCSCORE_2 == 1, 2,
ifelse(df$CCSCORE_1 == 1, 1, 0)))))
regress = function(df, variable){
df_red = df %>% filter(get(variable) <= quantile(df[[variable]], probs = 0.99, na.rm=TRUE))
df_red = df_red %>% mutate(impatience_sq = impatience*impatience,
impatience_2_sq = impatience_2*impatience_2,
risk_sq = risk*risk,
risk_2_sq = risk_2*risk_2)
mod=lm(data=df_red, as.formula(paste(variable, " ~ impatience + impatience_sq + impatience_2 + impatience_2_sq + risk + risk_sq + risk_2 + risk_2_sq +", paste(controles, collapse='+'))))
summary(mod)
}
ggplot(data=df) +
geom_smooth(aes(x=risk, y=IMPAGADOR), span=1, method = 'loess')
ggplot(data=df) +
geom_smooth(aes(x=impatience, y=MONTO), span=1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=risk), span=1, method = 'loess')
ggplot(data=df %>% filter(BC_SCORE >= 600, BC_SCORE <= 700)) +
geom_smooth(aes(x=BC_SCORE, y=impatience_2), span=1, method = 'loess')
regress(df, 'BC_SCORE')
regress(df, 'INGRESO')
regress(df, 'MONTO')
regress(df, 'IMPAGADOR')
#--------------------------------------------#
#-----------   BC SCORE    ------------------#
#--------------------------------------------#
regress(df, 'BC_SCORE')
df$USER_AGE
regress(df, 'USER_AGE')
ggplot(data=df) +
geom_smooth(aes(y=USER_AGE, x=risk), span=1, method = 'loess') +
xlab("Paciencia") + ylab("Ingreso") +
theme_minimal() + ggtitle("Promedio de ingreso vs paciencia") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df) +
geom_smooth(aes(x=USER_AGE, y=risk), span=1, method = 'loess') +
xlab("Paciencia") + ylab("Ingreso") +
theme_minimal() + ggtitle("Promedio de ingreso vs paciencia") +
theme(plot.title = element_text(hjust=0.5))
hist(df$USER_AGE)
ggplot(data=df %>% filter(USER_AGE < 60)) +
geom_smooth(aes(x=USER_AGE, y=risk), span=1, method = 'loess') +
xlab("Paciencia") + ylab("Ingreso") +
theme_minimal() + ggtitle("Promedio de ingreso vs paciencia") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(USER_AGE < 60)) +
geom_smooth(aes(x=USER_AGE, y=risk), span=1, method = 'loess') +
xlab("Age") + ylab("Risk") +
theme_minimal() + ggtitle("Promedio de riesgo vs edad") +
theme(plot.title = element_text(hjust=0.5))
ggplot(data=df %>% filter(USER_AGE < 60)) +
geom_smooth(aes(x=USER_AGE, y=impatience), span=1, method = 'loess') +
xlab("Age") + ylab("Risk") +
theme_minimal() + ggtitle("Promedio de riesgo vs edad") +
theme(plot.title = element_text(hjust=0.5))
variable = "IMPAGADOR"
df_red = df %>% filter(get(variable) <= quantile(df[[variable]], probs = 0.99, na.rm=TRUE))
df_red = df_red %>% mutate(impatience_sq = impatience*impatience,
impatience_2_sq = impatience_2*impatience_2,
risk_sq = risk*risk,
risk_2_sq = risk_2*risk_2)
mod=lm(data=df_red, as.formula(paste(variable, " ~ impatience + impatience_sq + impatience_2 + impatience_2_sq + risk + risk_sq + risk_2 + risk_2_sq +", paste(controles, collapse='+'))))
summary(mod)
